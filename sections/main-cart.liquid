{%- comment -%}
  Main Cart Section
  Displays cart contents with quantity adjustment and checkout button.
{%- endcomment -%}

<section class="py-10 sm:py-14 lg:py-20">
  <div class="max-w-screen-lg mx-auto px-4 sm:px-6 lg:px-8">

    <h1 class="font-serif-en text-3xl sm:text-4xl font-light text-kameya-dark tracking-wide text-center mb-8">
      Your Cart
    </h1>
    <div class="flex justify-center mb-10">
      <div class="w-12 h-px bg-kameya-muted-gold"></div>
    </div>

    {%- if cart.item_count > 0 -%}
      <form action="{{ routes.cart_url }}" method="post" novalidate>
        {%- comment -%} Cart Items {%- endcomment -%}
        <div class="border-t border-kameya-light-gray/50">
          {%- for item in cart.items -%}
            <div class="flex items-start py-6 border-b border-kameya-light-gray/50 gap-4 sm:gap-6">
              {%- comment -%} Image {%- endcomment -%}
              <a href="{{ item.url }}" class="flex-shrink-0 w-20 sm:w-28 aspect-square bg-kameya-cream overflow-hidden">
                {%- if item.image -%}
                  <img
                    src="{{ item.image | image_url: width: 200 }}"
                    alt="{{ item.image.alt | default: item.title }}"
                    class="w-full h-full object-cover"
                    loading="lazy"
                  >
                {%- endif -%}
              </a>

              {%- comment -%} Details {%- endcomment -%}
              <div class="flex-1 min-w-0">
                {%- if item.vendor != blank -%}
                  <p class="text-[10px] tracking-[0.15em] uppercase text-kameya-muted-gold font-serif-en mb-0.5">{{ item.vendor }}</p>
                {%- endif -%}
                <h3 class="font-serif-en text-sm sm:text-base text-kameya-dark leading-snug">
                  <a href="{{ item.url }}" class="hover:text-kameya-deep-red transition-colors">{{ item.product.title }}</a>
                </h3>
                {%- unless item.product.has_only_default_variant -%}
                  <p class="text-xs text-kameya-warm-gray mt-0.5 font-sans">{{ item.variant.title }}</p>
                {%- endunless -%}

                <div class="mt-3 flex items-center space-x-3">
                  <label for="updates_{{ item.key }}" class="sr-only">Quantity</label>
                  <div class="flex items-center border border-kameya-light-gray">
                    <button
                      type="button"
                      class="w-8 h-8 flex items-center justify-center text-kameya-warm-gray hover:text-kameya-dark transition-colors text-sm"
                      aria-label="Decrease quantity"
                      onclick="const i=this.nextElementSibling;i.value=Math.max(0,parseInt(i.value)-1);i.form.submit();"
                    >&minus;</button>
                    <input
                      type="number"
                      id="updates_{{ item.key }}"
                      name="updates[]"
                      value="{{ item.quantity }}"
                      min="0"
                      class="w-10 h-8 text-center text-sm text-kameya-dark bg-transparent border-x border-kameya-light-gray font-sans focus:outline-none"
                    >
                    <button
                      type="button"
                      class="w-8 h-8 flex items-center justify-center text-kameya-warm-gray hover:text-kameya-dark transition-colors text-sm"
                      aria-label="Increase quantity"
                      onclick="const i=this.previousElementSibling;i.value=parseInt(i.value)+1;i.form.submit();"
                    >&plus;</button>
                  </div>
                  <a href="{{ item.url_to_remove }}" class="text-xs text-kameya-warm-gray hover:text-kameya-deep-red transition-colors font-sans underline">
                    Remove
                  </a>
                </div>
              </div>

              {%- comment -%} Price {%- endcomment -%}
              <div class="flex-shrink-0 text-right">
                <p class="font-serif-en text-sm text-kameya-dark">{{ item.final_line_price | money }}</p>
                {%- if item.original_line_price != item.final_line_price -%}
                  <p class="text-xs text-kameya-warm-gray line-through mt-0.5">{{ item.original_line_price | money }}</p>
                {%- endif -%}
              </div>
            </div>
          {%- endfor -%}
        </div>

        {%- comment -%} Cart Footer {%- endcomment -%}
        <div class="mt-8 flex flex-col items-end">
          {%- if cart.cart_level_discount_applications.size > 0 -%}
            {%- for discount in cart.cart_level_discount_applications -%}
              <div class="flex items-center justify-between w-full sm:w-96 mb-2">
                <span class="text-sm text-kameya-deep-red font-sans">{{ discount.title }}</span>
                <span class="text-sm text-kameya-deep-red font-sans">-{{ discount.total_allocated_amount | money }}</span>
              </div>
            {%- endfor -%}
          {%- endif -%}

          <div class="flex items-center justify-between w-full sm:w-96 py-4 border-t border-kameya-light-gray/50">
            <span class="font-serif-en text-sm tracking-[0.1em] uppercase text-kameya-dark">Subtotal</span>
            <span class="font-serif-en text-lg text-kameya-dark">{{ cart.total_price | money }}</span>
          </div>
          <p class="text-xs text-kameya-warm-gray font-sans mb-4">Taxes and shipping calculated at checkout.</p>

          <div class="w-full sm:w-96 space-y-3">
            <button
              type="submit"
              name="checkout"
              class="w-full flex items-center justify-center px-8 py-4 bg-kameya-dark text-white font-serif-en text-sm tracking-[0.2em] uppercase hover:bg-kameya-charcoal transition-colors"
            >
              Proceed to Checkout
            </button>
            <a href="{{ routes.all_products_collection_url }}" class="w-full flex items-center justify-center px-8 py-3 border border-kameya-dark text-kameya-dark font-serif-en text-xs tracking-[0.2em] uppercase hover:bg-kameya-dark hover:text-white transition-all">
              Continue Shopping
            </a>
          </div>
        </div>
      </form>

    {%- else -%}
      <div class="text-center py-16">
        <svg class="w-16 h-16 mx-auto text-kameya-light-gray mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
        </svg>
        <p class="font-serif-en text-lg text-kameya-warm-gray mb-6">Your cart is empty.</p>
        <a href="{{ routes.all_products_collection_url }}" class="inline-block border border-kameya-dark text-kameya-dark px-10 py-3.5 font-serif-en text-xs tracking-[0.2em] uppercase hover:bg-kameya-dark hover:text-white transition-all">
          Explore Collection
        </a>
      </div>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "Cart",
  "tag": "section",
  "class": "main-cart",
  "settings": []
}
{% endschema %}
